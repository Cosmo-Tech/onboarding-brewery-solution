{
  "commandTemplates": [
    {
      "id": "on_exit",
      "command": "python",
      "useSystemEnvironment": true,
      "arguments": [
        "code/run_templates/sample_complete/notify_kafka.py",
        "--notify-kafka", "${NOTIFY_KAFKA}",
        "--kafka-broker", "${KAFKA_BROKER}",
        "--kafka-topic", "${KAFKA_TOPIC}",
        "--kafka-username", "${KAFKA_USERNAME}",
        "--kafka-password", "${KAFKA_PASSWORD}"
      ]
    }
  ],
  "steps": [
    {
      "id": "readLocalToStore",
      "command": "csm-data",
      "useSystemEnvironment": true,
      "arguments": [
        "store",
        "load-csv-folder",
        "--store-folder",
        "$CSM_TEMP_ABSOLUTE_PATH/tmpstore",
        "--csv-folder",
        "code/run_templates/sample_complete/InputDataset"
      ]
    },
    {
      "id": "InitECSWithStore",
      "command": "csm-data",
      "useSystemEnvironment": true,
      "arguments": [
        "store",
        "dump-to-s3",
        "--bucket-name",
        "inputData",
        "--output-type",
        "csv",
        "--store-folder",
        "$CSM_TEMP_ABSOLUTE_PATH/tmpstore",
        "--prefix",
        "$CSM_RUN_ID/inputs/"
      ],
      "precedents": [
        "readLocalToStore"
      ]
    },
    {
      "id": "DownloadDatasetFromECS",
      "command": "csm-data",
      "useSystemEnvironment": true,
      "arguments": [
        "s3-bucket-download",
        "--bucket-name",
        "inputData",
        "--prefix-filter",
        "$CSM_RUN_ID/inputs/"
      ],
      "precedents": [
        "InitECSWithStore"
      ]
    },
    {
      "id": "RunSimulation",
      "command": "main",
      "arguments": [
        "-i",
        "BusinessApp_Simulation"
      ],
      "useSystemEnvironment": true,
      "precedents": [
        "DownloadDatasetFromECS"
      ]
    },
    {
      "id": "LoadResultsInStore",
      "command": "csm-data",
      "useSystemEnvironment": true,
      "arguments": [
        "store",
        "load-csv-folder",
        "--csv-folder",
        "$CSM_OUTPUT_ABSOLUTE_PATH"
      ],
      "precedents": [
        "RunSimulation"
      ]
    },
    {
      "id": "SendResultsToPSQL",
      "command": "csm-data",
      "useSystemEnvironment": true,
      "arguments": [
        "store",
        "dump-to-postgresql",
        "--table-prefix",
        "$CSM_RUN_ID_"
      ],
      "precedents": [
        "LoadResultsInStore"
      ]
    },
    {
      "id": "SendResultsToECS",
      "command": "csm-data",
      "useSystemEnvironment": true,
      "arguments": [
        "store",
        "dump-to-s3",
        "--output-type",
        "parquet",
        "--prefix",
        "$CSM_RUN_ID/results/"
      ],
      "precedents": [
        "LoadResultsInStore"
      ]
    }
  ]
}
